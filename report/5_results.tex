\chapter{Experiments and results}


\begin{comment}
    \chapter{Results and variations}
This section provides an overview of the numerical outcomes generated by the methods we have introduced. We commence with a straightforward illustration from the example outlined in paper \cite{mission}, where in the focus lies on elucidating the process of designing neural network structures and selecting hyperparameters. In the subsequent example, we extend this algorithm to a specific interest rate product under more intricate conditions, subsequently comparing the outcomes with benchmark methods. Lastly, we propose a more generalized model and show its results.

\section{Application on 1D vanilla American put option}
Let's consider American options within the framework of the Black-Scholes Model. The price of this asset adheres to the dynamic described by $X_{t}=S_{t}$: $$dS_{t}=rS_{t}dt+\sigma S_{t}dW_{t}.$$ and the discounted factor is $\beta_{t}=\exp(rt)$. Consequently, the core formula for this scenario can be simplified to 
$$ \frac{V_{t_{i+1}}}{\beta_{\Delta t}} \approx 
        \Phi_{t_{i}}(S_{t_{i}})+
        \beta_{t_{i}}(\Psi_{t_{i}}(S_{t_{i}})\Delta W_{t_{i}} + \sigma \Psi^{'}_{t_{i}}(S_{t_{i}})(\frac{\Delta W_{t_{i}}^{2}-\Delta t}{2}))$$

In the first example, we assess the pricing of a one-dimensional (1D) vanilla American put option. This option matures at $T = 1$ and holds a strike price of $K = 40$, with an initial price of $S_{0} = 36$. The associated parameters include a risk-free rate, $r = 0.06$, and a volatility factor, $\sigma = 0.2$. The payoff function at time $t$ is represented as $Z(S_{t},K) = (K-S_{t})^{+}$.

A crucial point lies in the method of constructing the neural network model within the black-box framework. Through exploratory experiments, we have identified an effective strategy involving the utilization of two mutually independent networks to separately approximate these two functions, as depicted in the following graph \ref{NN}. This approach proves advantageous, as martingale increment and continuation value functions can exhibit diverse complexities, particularly in intricate models characterized by higher dimensions.
\begin{figure}[ht]
\includegraphics[scale=0.4]{images/NN.png} 
\caption{The Structure of Neural Networks}
\label{NN} 
\end{figure}

When it comes to selecting appropriate hyperparameters during the training process, we rely on the Python library \textbf{Optuna} to obtain values that are relatively optimal. The validation loss values derived from various hyperparameter combinations are presented in Figure \ref{optuna1}, while the importance ranking of these hyperparameters is shown in Figure \ref{optuna2}.

\begin{figure}[!h]
    \centering
    \includegraphics[scale=0.2]{images/optuna1.png}
    \caption{The outcomes from combinations of hyperparameters}
    \label{optuna1}
\end{figure}

\begin{figure}[!h]
    \centering
    \includegraphics[scale=0.3]{images/optuna2.png}
    \caption{The importance indices for the hyperparameter}
    \label{optuna2}
\end{figure}

To conduct the results, we discretize the time interval $[0, t]$ into 50 sub-intervals and employ $10^{5}$ paths to compute the price of this option. With the neural networks has structure  $[(20,20),(20,20,20)]$, and learning rate is set at $0.0008$, the batch size is designated as $1000$, and the training proceeds for a total of $200$ epochs. 
When executing Algorithm 1 and training the model in each step, the previously trained network parameters can be utilized as initial values for the next model. This can save a lot of training time. This is justifiable due to the analogous shapes exhibited by both the continuation functions and martingale increment functions at different time instances. Given the resemblances observed in \cite{mission}, the parameters of corresponding networks are expected to bear similarities as well.

Ultimately, we have obtained results that closely align with those presented in the paper $(4.4762 \  \text{v.s.} \ 4.4887)$. Additionally, it is evident that the Milstein Scheme outperforms the Euler Scheme, underscoring the superiority of employing the second-order approximation inherent to the Milstein Scheme. Consequently, we opt to standardize our algorithm utilizing the Milstein Scheme for enhanced performance which is different from the paper who use the Euler Scheme in the Algorithm.
\begin{table}
    \centering
    \begin{tabular}{lccc}
        \hline
         &Lower Bound  &Upper Bound  &Difference\\
        \hline
        Euler Scheme &4.467572  &4.576317 &0.108745\\
        \hline
        Milstein Scheme &4.475878  &4.491022  &0.015144‬\\
        \hline
    \end{tabular}
\caption{Results on Equity}
\label{Res_equity}
\end{table}

\section{Application on Interest Rate Products}
In this particular example, we extend the application of our algorithm to address the pricing of interest rate options under the Hull-White model. For the sake of comparative analysis, we select the PDE Pricer and the Rogers' method as benchmarks to evalue the results obtained. Lastly, we conclude by introducing a broader perspective into the model by introducing randomization to both the spot rate $r$ and $\sigma$, thus achieving a more comprehensive framework.

\subsection{Hull White model and Bermudan Floor}
The employed market-simulation model is the Hull-White model, a specification within the HJM framework that provides a comprehensive representation of the forward rate curve. Thus, we operate within a filtered probability space $(\Omega, \mathcal{F}, \mathbb{Q}, (\mathcal{F}_{t})_{t \in [0,T_{n}]})$, where $T_{n} > 0$ designates a fixed finite horizon. Under an equivalent martingale measure $\mathbb{Q}$, the dynamics $P_{t,T}$ of the price at time $t$ for a zero-coupon bond maturing at $T$ are expressed as:
\begin{equation}\label{zc}
dP_{t,T} =P_{t,T}(r_{t}dt+\sigma(t)\frac{1-e^{-\lambda(T-t)}}{\lambda}dW_{t}^{\mathbb{Q}})    
\end{equation}

Here, $r_{t}$ denotes the instantaneous risk-free short rate, $\lambda$ represents the mean-reversion parameter, and $W_{t}^{\mathbb{Q}}$ signifies a Brownian motion under $\mathbb{Q}$. We introduce the notation:
$$
\gamma_{t,T,\lambda}=\sigma(t)\eta_{t,T,\lambda} = \sigma(t)\frac{1-e^{-\lambda(T-t)}}{\lambda}
$$

The solution to equation \ref{zc} is obtained as:
$$
P_{t,T} = P_{0,T} \exp(\int_{0}^{t}(r_{s}-\frac{1}{2}\gamma_{s,T,\lambda}^{2})ds + \int_{0}^{t}\gamma_{s,T,\lambda}dW_{s}^{\mathbb{Q}})
$$
Note that, throughout this report, we assume that $\sigma(t) = \sigma$ is constant.

By formulating the solution for the process $P_{s,t}$, expressing the ratio $\frac{P_{t,T}}{P_{s,t}}$, and taking the limit as $s \rightarrow t$, after computations, we derive an expression for $P_{t,T}$ that don't depend on the process $r_{t}$:
$$
P_{t,T} = \frac{P_{0,T}}{P_{0,t}}\exp (-\frac{\sigma^{2}}{2}\eta_{t,T,\lambda}(\eta_{0,t,\lambda}^{2}+\eta_{t,T,\lambda}\eta_{0,t,2\lambda}))\exp(\eta_{t,T,\lambda}\int_{0}^{t}\sigma e^{-\lambda(t-s)}dW_{s}^{\mathbb{Q}})
$$

Now we pass the measure $\mathbb{Q}$ denoted the risk-neutral probability measure, which is associated with the numeraire $\beta_{t} = e^{\int_{0}^{t}r_{s}ds}$ to the forward measure $\mathbb{Q}^{T}$ represented the forward-neutral probability measure of maturity, linked to the zero-coupon numeraire $P_{t,T}$. So,
$$
\frac{d\mathbb{Q}^{T}}{d\mathbb{Q}}|_{\mathcal{F}_{t}} := \frac{\beta_{0}P_{t,T}}{\beta_{t}P_{0,T}}
$$
Through the application of Girsanov's theorem, the transition from the forward measures to the risk-neutral measure is represented as: 
$$dW_{s}^{\mathbb{Q}^{T}} = dW_{s}^{\mathbb{Q}}-\gamma_{s,T}ds.$$

Furthermore, the transition between forward measures is also established as:
$$dW_{s}^{\mathbb{Q}^{T}}+\gamma_{s,T}ds = dW_{s}^{\mathbb{Q}^{T^{'}}}+\gamma_{s,T^{'}}ds.$$

Shift our focus to the pricing measure $\mathbb{Q}^{T_{n}}$, where $T_{n}$ is the horizon date.

Consequently, we arrive at 
\begin{equation}
   P_{t,T} = \frac{P_{0,T}}{P_{0,t}}\exp (\sigma^{2} \eta_{t,T,\lambda} \eta_{t,T_{n},\lambda} \eta_{0,t,2\lambda}-\frac{1}{2}\sigma^{2}\eta_{t,T,\lambda}^{2}\eta_{0,t,2\lambda})\exp(\eta_{t,T,\lambda}X_{t}). 
\end{equation}
where $X_{t} = \int_{0}^{t}\sigma e^{-\lambda(t-s)}dW_{s}^{\mathbb{Q}^{T_{n}}}$ represents an abstract diffusion process under measure $\mathbb{Q}^{T_{n}}$. It is worthy to note that diffusing the process $X_{t}$ enables us to diffuse all zero-coupon bonds of various maturities at time $t$, as the remaining components of the formula are deterministic. Moreover, the process $X_{t}$ is a Wiener integral, making it a Gaussian process:
$$
X_{t} \sim \mathcal{N}(0,\int_{0}^{t}\sigma^{2}e^{-2 \lambda(t-s)}ds) = \mathcal{N}(0,\sigma^{2}\eta_{0,t,2\lambda}).
$$
For the sake of convenience, we conduct our example on a non-existent product - Bermudan Floor. In this context, $ X_{t}$ represents the diffusion process, while $P_{t,T_{n}}(X_{t})$ serves as the Numeraire, denoting the discounted factor. The payoff for the Bermuda Floor is denoted as 
$$
Z_{T}=P_{T,T+\theta}*(L(T,T+\theta)-K)^{+}*\theta,
$$
where $T$ is the maturity of the option, $\theta$ represents the time between the exercise date and the settlement date, $T_{n}=T+\theta$ is the horizon date while $K$ is the strike. And $ L(T,T+\theta) = (\frac{1}{P(T,T+\theta)}-1)\frac{1}{\theta} \ \text{is the LIBOR.}$
So the pricing problem is 
\begin{align*}
V_{0} &= \sup_{\tau \in\mathcal{T}} \mathbb{E}^{Q}[e^{-\int _{0}^{\tau+\theta}r_{s}ds}\theta(K-L(\tau,\tau+\theta))_{+}]\\
&=\sup_{\tau \in\mathcal{T}} P_{0,T_{n}}\mathbb{E}^{Q^{T_{n}}}[\frac{Z_{\tau}}{P_{\tau,T_{n}}}]
\end{align*}
where $Z_{t} &= P_{t,t+\theta}\theta(K-L(t,t+\theta))^{+}$.
Thus, the core formula in this case become:
$$
  P_{t_{i},T_{n}}\frac{V_{t_{i+1}}}{P_{t_{i+1},T_{n}}} \approx \Phi(X_{t_{i}})+P_{t_{i},T_{n}}(\Psi(X_{t_{i}})\Delta W_{t_{i}} + \sigma \Psi^{'}(X_{t_{i}})(\frac{\Delta W_{t_{i}}^{2}-\Delta t}{2})).
$$
\subsection{Benchmarks}
Before delving into the presentation of results, let us introduce two conventional pricing methods to serve as benchmarks.
\subsubsection{PDE pricer}
Let's consider a European option over the interval $[t,T]$ and denote its value function as $\pi$. We have:
\begin{align}
    \pi(x,t) &=\mathbb{E}^{\mathbb{Q}}[e^{-\int_{t}^{T}r_{u}ds}Z(X_{T})|X_{t}=x]\\
    &=P_{t,T_{n}}\mathbb{E}^{\mathbb{Q}^{T_{n}}}[\frac{Z(X_{T})}{P_{T,T_{n}}}|X_{t}=x]
\end{align}
Let $u(x,t) = \mathbb{E}^{\mathbb{Q}^{T_{n}}}[\frac{Z(X_{T})}{P_{T,T_{n}}}|X_{t}=x]$.
Since $X_{t}$ follows an Itô process, we have:
$$dX_{t} = -\lambda X_{t}dt + \sigma dW_{t}^{\mathbb{Q}^{T_{n}}}.$$
According to the Feynman-Kac theorem, $u$ satisfies the following partial differential equation:
$$\frac{\partial u}{\partial t}(x,t)-\lambda x\frac{\partial u}{\partial x}+\frac{1}{2} \sigma^{2}\frac{\partial^{2} u}{\partial x^{2}} = 0,$$
with the terminal condition: $u(x,T)=\frac{Z(x,T)}{P(T,T_{n})(x)}$.

We apply the Crank-Nicolson Scheme to discretize the PDE:
\begin{align}
    &\frac{\partial u}{\partial t} = \frac{u_{i}(t_{j})-u_{i}(t_{j-1})}{\Delta t} \\
    &\frac{\partial u}{\partial x} =\frac{1}{2}\frac{u_{i+1}(t_{j})-u_{i-1}(t_{j})+u_{i+1}(t_{j-1})-u_{i-1}(t_{j-1})}{2\Delta x}\\
    &\frac{\partial^{2} u}{\partial x^{2}} =\frac{1}{2} \frac{\overbrace{[u_{i+1}(t_{j})+u_{i-1}(t_{j})-2u_{i}(t_{j})]}^{y(t_{j})}+[y(t_{j-1})]}{(\Delta x)^{2}}
\end{align}
Hence, the solution vector U satisfies: 
$$AU^{i}=MU^{i+1}+b.$$

The pricing of Bermudan options $(t \in \{0=t_{0},t_{1},...,t_{N}=T\})$ directly stems from that of European options:
\begin{itemize}
    \item The first step involves solving the PDE over the interval $[t_{N-1},t_{N}]$.
    \item At $t_{N-1}$, we have 
    $$ \pi(x,t_{N-1}) = \max\{Z_{t_{N-1}}(x),\mathbb{E}^{\mathbb{Q}^{T_{n}}}[\frac{Z_{t_{N}}}{P_{t_{N},T_{n}}}|X_{N-1}=x]*P_{t_{N-1},T_{n}}\}$$
    where the conditional expectation is determined by the solution vector.
    \item Subsequently, we iteratively solve the equation over distinct intervals $[t_{i}, t_{i+1}]$ comparing the immediate exercise value with the continuation value at each exercise date.
\end{itemize}
\subsubsection{Rogers' method}
The concept of Rogers' method is rooted in the dual formulation of option pricing. However, the selection of the martingale differs from the approach we have introduced. The procedure unfolds as follows:
\begin{itemize}
    \item We choose this specific martingale $M$ is:$$dM_{t} = d\tilde{P}(t,X_{t}),$$ where $\tilde{P}(t,X_{t})$ is the discounted price of the corresponding European option at time $t$.
    \item Subsequently, we endeavor to identify the relatively optimal linear form of this martingale in relation to the dual formula. $$\inf_{\lambda} \mathbb{E}[\sup_{t\leq T}(\beta_{t}^{-1}Z(X_{t})-\lambda M_{t})].$$
    \item Consequently, our objective shifts towards finding the minimizer $\lambda$.
\end{itemize}

\subsection{Results}
In this section, we will unveil the prices obtained through various methodologies for the Bermudan Floor under the Hull-White model. In addition, we subject these methods to testing both on 5 and 50 exercise dates.

In the subsequent example, the parameters are as follows: Maturity $T=10$, Strike $K = 0.03$, $r=0.005$, $\sigma = 0.005$, $\lambda = 0.02$, $\theta = 1$, $T_{n} = T+\theta$. 
During the implementation, we simulate $10^{5}$ paths. For training the neural networks, we follow the same methodology as in the previous example for hyperparameter tuning. Specifically, the neural network architecture is structured as [(50, 50), (50, 30, 30)]. The learning rate is set at $0.0004$, the batch size is chosen as $800$, and the training is conducted over $150$ epochs.

As demonstrated in Table 3.2, it is evident that with an increase in the number of exercise dates, there is a corresponding augmentation in both the lower and upper bounds of the option price. Consequently, the differences between the upper and lower bounds of the price diminishes.
\begin{table}[!h]
\centering
    \begin{tabular}{lccc}
        \hline
        &Lower Bound &Upper Bound  &Difference\\
        \hline
        5 exercise dates &0.024758  &0.024855 &9.73785e-05\\
        \hline
        50 exercise dates &0.024872  &0.024912  &3.995538e-05\\
        \hline
    \end{tabular}
    \caption{Results on Bermudan Floor}
\end{table}

Tables 3.3, 3.4 and Figure 3.4 offer a comparative analysis between the established benchmarks and the algorithm outlined above. A notable observation is that the prices obtained through neural networks adeptly function as robust lower and upper bounds, outperforming Rogers' method. Intriguingly, the precision of prices achieved through neural networks increases with a higher count of exercise dates.

\begin{table}[!h]
\centering
\begin{tabular}{lcccc}
    \hline
    &L.B. &Approx. Value &U.B. &Diff. \\
    \hline
     NN &0.024758  &- &0.024855 &-\\
    \hline
     Rogers &-  &-  &0.024938 &+8.3144e-05(w.r.t U)\\
    \hline
     PDE &-  &0.024783  &- &+2.5212e-05(w.r.t L)\\
     \hline
\end{tabular}
\caption{Compare with Benchmarks - 5 exercise dates}
\end{table}

\begin{table}[!h]
    \centering
    \begin{tabular}{lcccc}
        \hline
        &L.B. &Approx. Value &U.B. &Diff. \\
        \hline
        NN &0.024872  &- &0.024912 &-\\
        \hline
        Rogers &-  &-  &0.024999 &+8.648e-05(w.r.t U)\\
        \hline
        PDE &-  &0.024794  &- &+7.249e-06(w.r.t L)\\
        \hline
    \end{tabular}
    \caption{Compare with Benchmarks - 50 exercise dates}
\end{table}

\begin{figure}[!h]
    \centering  
    \subfigure{
    \label{ci1}
    \includegraphics[width=0.46\textwidth]{images/CI1.png}}
    \subfigure{
    \label{ci2}
    \includegraphics[width=0.46\textwidth]{images/CI2.png}}
    \caption{Visualization Confidence Intervals}
\end{figure}
Continuing within the context of 5 exercise dates, we now vary the strike values and plot the resulting prices.
\begin{figure}[!h]
    \includegraphics[scale=0.55]{images/floor_5_vary_K.png}
    \caption{Prices vary with K}
    \label{K}
\end{figure}

Indeed, as shown in the Figure \ref{K}, the neural network algorithm exhibits a strong and robust performance similar to that of traditional methods, except for the case where K is particularly small.

\section{Generalized Models}
Let's continue discussing the context of Bermudan Floor within the Hull-White model. In the previous examples, the spot rate $r$ and volatility $\sigma$ were treated as fixed constants, which may not be entirely practical in real-world applications. To address this limitation, we introduce a more general model. In the data simulation phase, we introduce randomness to both $r$ and $\sigma$, considering them as integral components of the input data. The conceptual representation of this idea is illustrated in the Figure \ref{nn2}.
\begin{figure}[!h]
    \centering
    \includegraphics[scale=0.45]{images/NN2.png}
    \caption{Neural Networks with $\sigma$ and r as inputs}
    \label{nn2}
\end{figure}

Furthermore, we proceed to plot graphs where we keep $r$ fixed while varying $\sigma$, as well as keeping $\sigma$ fixed while varying $r$. 
All other parameters remain unchanged, maturity $T=10$, Strike $K = 0.03$, $\lambda = 0.02$, $\theta = 1$, $T_{n} = T+\theta$.

As evident from Figures \ref{sigma} and \ref{r}, despite some loss of precision compared to the initial models, however, our generalized model is still robust and consistently generates reliable prices.
\begin{figure}[!h]
    %\centering
    \includegraphics[scale=0.52]{images/sigma.png}
    \caption{Prices vary with $\sigma$ (r = 0.005)}
    \label{sigma}
\end{figure}

\begin{figure}[!h]
    \centering
    \includegraphics[scale=0.52]{images/r.png}
    \caption{Prices vary with r ($\sigma$ = 0.04)}
    \label{r}
\end{figure}
\end{comment}
